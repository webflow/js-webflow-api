/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../mock-server/MockServerPool.js";
import { WebflowClient } from "../../src/Client";

describe("Pages", () => {
    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new WebflowClient({
            accessToken: "test",
            environment: {
                base: server.baseUrl,
                dataApi: server.baseUrl,
                contentDeliveryApi: server.baseUrl,
                production: server.baseUrl,
                cdn: server.baseUrl,
            },
        });

        const rawResponseBody = {
            pages: [
                {
                    id: "6596da6045e56dee495bcbba",
                    siteId: "6258612d1ee792848f805dcf",
                    title: "Guide to the Galaxy",
                    slug: "guide-to-the-galaxy",
                    createdOn: "2024-03-11T10:42:00Z",
                    lastUpdated: "2024-03-11T10:42:42Z",
                    archived: false,
                    draft: false,
                    canBranch: false,
                    isBranch: true,
                    branchId: "68026fa68ef6dc744c75b833",
                    seo: {
                        title: "The Ultimate Hitchhiker's Guide to the Galaxy",
                        description:
                            "Everything you need to know about the galaxy, from avoiding Vogon poetry to the importance of towels.",
                    },
                    openGraph: {
                        title: "Explore the Cosmos with The Ultimate Guide",
                        titleCopied: false,
                        description:
                            "Dive deep into the mysteries of the universe with your guide to everything galactic.",
                        descriptionCopied: false,
                    },
                    localeId: "653fd9af6a07fc9cfd7a5e57",
                    publishedPath: "/en-us/guide-to-the-galaxy",
                },
                {
                    id: "6596da6045e56dee495bcbad",
                    siteId: "6258612d1ee792848f805dcf",
                    title: "Towel Day Celebrations",
                    slug: "towel-day",
                    createdOn: "2024-05-25T09:00:00Z",
                    lastUpdated: "2024-05-25T09:42:00Z",
                    archived: false,
                    draft: false,
                    canBranch: true,
                    isBranch: false,
                    seo: {
                        title: "Celebrate Towel Day - The Hitchhiker's Guide to the Galaxy",
                        description:
                            "A guide to celebrating Towel Day, in honor of the most massively useful thing an interstellar hitchhiker can have.",
                    },
                    openGraph: {
                        title: "Towel Day - Don't Panic",
                        titleCopied: false,
                        description:
                            "Join the galaxy in celebrating Towel Day, the day dedicated to carrying towels everywhere in memory of Douglas Adams.",
                        descriptionCopied: false,
                    },
                    localeId: "653fd9af6a07fc9cfd7a5e57",
                    publishedPath: "/en-us/towel-day",
                },
            ],
            pagination: { limit: 20, offset: 0, total: 2 },
        };
        server
            .mockEndpoint()
            .get("/sites/580e63e98c9a982ac9b8b741/pages")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.pages.list("580e63e98c9a982ac9b8b741", {
            localeId: "65427cf400e02b306eaa04a0",
        });
        expect(response).toEqual({
            pages: [
                {
                    id: "6596da6045e56dee495bcbba",
                    siteId: "6258612d1ee792848f805dcf",
                    title: "Guide to the Galaxy",
                    slug: "guide-to-the-galaxy",
                    createdOn: new Date("2024-03-11T10:42:00.000Z"),
                    lastUpdated: new Date("2024-03-11T10:42:42.000Z"),
                    archived: false,
                    draft: false,
                    canBranch: false,
                    isBranch: true,
                    branchId: "68026fa68ef6dc744c75b833",
                    seo: {
                        title: "The Ultimate Hitchhiker's Guide to the Galaxy",
                        description:
                            "Everything you need to know about the galaxy, from avoiding Vogon poetry to the importance of towels.",
                    },
                    openGraph: {
                        title: "Explore the Cosmos with The Ultimate Guide",
                        titleCopied: false,
                        description:
                            "Dive deep into the mysteries of the universe with your guide to everything galactic.",
                        descriptionCopied: false,
                    },
                    localeId: "653fd9af6a07fc9cfd7a5e57",
                    publishedPath: "/en-us/guide-to-the-galaxy",
                },
                {
                    id: "6596da6045e56dee495bcbad",
                    siteId: "6258612d1ee792848f805dcf",
                    title: "Towel Day Celebrations",
                    slug: "towel-day",
                    createdOn: new Date("2024-05-25T09:00:00.000Z"),
                    lastUpdated: new Date("2024-05-25T09:42:00.000Z"),
                    archived: false,
                    draft: false,
                    canBranch: true,
                    isBranch: false,
                    seo: {
                        title: "Celebrate Towel Day - The Hitchhiker's Guide to the Galaxy",
                        description:
                            "A guide to celebrating Towel Day, in honor of the most massively useful thing an interstellar hitchhiker can have.",
                    },
                    openGraph: {
                        title: "Towel Day - Don't Panic",
                        titleCopied: false,
                        description:
                            "Join the galaxy in celebrating Towel Day, the day dedicated to carrying towels everywhere in memory of Douglas Adams.",
                        descriptionCopied: false,
                    },
                    localeId: "653fd9af6a07fc9cfd7a5e57",
                    publishedPath: "/en-us/towel-day",
                },
            ],
            pagination: {
                limit: 20,
                offset: 0,
                total: 2,
            },
        });
    });

    test("get-metadata", async () => {
        const server = mockServerPool.createServer();
        const client = new WebflowClient({
            accessToken: "test",
            environment: {
                base: server.baseUrl,
                dataApi: server.baseUrl,
                contentDeliveryApi: server.baseUrl,
                production: server.baseUrl,
                cdn: server.baseUrl,
            },
        });

        const rawResponseBody = {
            id: "6596da6045e56dee495bcbba",
            siteId: "6258612d1ee792848f805dcf",
            title: "Guide to the Galaxy",
            slug: "guide-to-the-galaxy",
            createdOn: "2024-03-11T10:42:00Z",
            lastUpdated: "2024-03-11T10:42:42Z",
            archived: false,
            draft: false,
            canBranch: false,
            isBranch: true,
            branchId: "68026fa68ef6dc744c75b833",
            seo: {
                title: "The Ultimate Hitchhiker's Guide to the Galaxy",
                description:
                    "Everything you need to know about the galaxy, from avoiding Vogon poetry to the importance of towels.",
            },
            openGraph: {
                title: "Explore the Cosmos with The Ultimate Guide",
                titleCopied: false,
                description: "Dive deep into the mysteries of the universe with your guide to everything galactic.",
                descriptionCopied: false,
            },
            localeId: "653fd9af6a07fc9cfd7a5e57",
            publishedPath: "/en-us/guide-to-the-galaxy",
        };
        server
            .mockEndpoint()
            .get("/pages/63c720f9347c2139b248e552")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.pages.getMetadata("63c720f9347c2139b248e552", {
            localeId: "65427cf400e02b306eaa04a0",
        });
        expect(response).toEqual({
            id: "6596da6045e56dee495bcbba",
            siteId: "6258612d1ee792848f805dcf",
            title: "Guide to the Galaxy",
            slug: "guide-to-the-galaxy",
            createdOn: new Date("2024-03-11T10:42:00.000Z"),
            lastUpdated: new Date("2024-03-11T10:42:42.000Z"),
            archived: false,
            draft: false,
            canBranch: false,
            isBranch: true,
            branchId: "68026fa68ef6dc744c75b833",
            seo: {
                title: "The Ultimate Hitchhiker's Guide to the Galaxy",
                description:
                    "Everything you need to know about the galaxy, from avoiding Vogon poetry to the importance of towels.",
            },
            openGraph: {
                title: "Explore the Cosmos with The Ultimate Guide",
                titleCopied: false,
                description: "Dive deep into the mysteries of the universe with your guide to everything galactic.",
                descriptionCopied: false,
            },
            localeId: "653fd9af6a07fc9cfd7a5e57",
            publishedPath: "/en-us/guide-to-the-galaxy",
        });
    });

    test("update-page-settings", async () => {
        const server = mockServerPool.createServer();
        const client = new WebflowClient({
            accessToken: "test",
            environment: {
                base: server.baseUrl,
                dataApi: server.baseUrl,
                contentDeliveryApi: server.baseUrl,
                production: server.baseUrl,
                cdn: server.baseUrl,
            },
        });
        const rawRequestBody = {
            title: "Guide to the Galaxy",
            slug: "guide-to-the-galaxy",
            seo: {
                title: "The Ultimate Hitchhiker's Guide to the Galaxy",
                description:
                    "Everything you need to know about the galaxy, from avoiding Vogon poetry to the importance of towels.",
            },
            openGraph: {
                title: "Explore the Cosmos with The Ultimate Guide",
                titleCopied: false,
                description: "Dive deep into the mysteries of the universe with your guide to everything galactic.",
                descriptionCopied: false,
            },
        };
        const rawResponseBody = {
            id: "6596da6045e56dee495bcbba",
            siteId: "6258612d1ee792848f805dcf",
            title: "Guide to the Galaxy",
            slug: "guide-to-the-galaxy",
            createdOn: "2024-03-11T10:42:00Z",
            lastUpdated: "2024-03-11T10:42:42Z",
            archived: false,
            draft: false,
            canBranch: false,
            isBranch: true,
            branchId: "68026fa68ef6dc744c75b833",
            seo: {
                title: "The Ultimate Hitchhiker's Guide to the Galaxy",
                description:
                    "Everything you need to know about the galaxy, from avoiding Vogon poetry to the importance of towels.",
            },
            openGraph: {
                title: "Explore the Cosmos with The Ultimate Guide",
                titleCopied: false,
                description: "Dive deep into the mysteries of the universe with your guide to everything galactic.",
                descriptionCopied: false,
            },
            localeId: "653fd9af6a07fc9cfd7a5e57",
            publishedPath: "/en-us/guide-to-the-galaxy",
        };
        server
            .mockEndpoint()
            .put("/pages/63c720f9347c2139b248e552")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.pages.updatePageSettings("63c720f9347c2139b248e552", {
            localeId: "65427cf400e02b306eaa04a0",
            title: "Guide to the Galaxy",
            slug: "guide-to-the-galaxy",
            seo: {
                title: "The Ultimate Hitchhiker's Guide to the Galaxy",
                description:
                    "Everything you need to know about the galaxy, from avoiding Vogon poetry to the importance of towels.",
            },
            openGraph: {
                title: "Explore the Cosmos with The Ultimate Guide",
                titleCopied: false,
                description: "Dive deep into the mysteries of the universe with your guide to everything galactic.",
                descriptionCopied: false,
            },
        });
        expect(response).toEqual({
            id: "6596da6045e56dee495bcbba",
            siteId: "6258612d1ee792848f805dcf",
            title: "Guide to the Galaxy",
            slug: "guide-to-the-galaxy",
            createdOn: new Date("2024-03-11T10:42:00.000Z"),
            lastUpdated: new Date("2024-03-11T10:42:42.000Z"),
            archived: false,
            draft: false,
            canBranch: false,
            isBranch: true,
            branchId: "68026fa68ef6dc744c75b833",
            seo: {
                title: "The Ultimate Hitchhiker's Guide to the Galaxy",
                description:
                    "Everything you need to know about the galaxy, from avoiding Vogon poetry to the importance of towels.",
            },
            openGraph: {
                title: "Explore the Cosmos with The Ultimate Guide",
                titleCopied: false,
                description: "Dive deep into the mysteries of the universe with your guide to everything galactic.",
                descriptionCopied: false,
            },
            localeId: "653fd9af6a07fc9cfd7a5e57",
            publishedPath: "/en-us/guide-to-the-galaxy",
        });
    });

    test("get-content", async () => {
        const server = mockServerPool.createServer();
        const client = new WebflowClient({
            accessToken: "test",
            environment: {
                base: server.baseUrl,
                dataApi: server.baseUrl,
                contentDeliveryApi: server.baseUrl,
                production: server.baseUrl,
                cdn: server.baseUrl,
            },
        });

        const rawResponseBody = {
            pageId: "658205daa3e8206a523b5ad4",
            branchId: "68026fa68ef6dc744c75b833",
            nodes: [
                { id: "id", text: {}, attributes: { key: "value" }, type: "text" },
                { id: "id", text: {}, attributes: { key: "value" }, type: "text" },
                { id: "id", image: {}, attributes: { key: "value" }, type: "image" },
                { id: "id", choices: [{ value: "value", text: "text" }], attributes: { key: "value" }, type: "select" },
                { id: "id", placeholder: "placeholder", attributes: { key: "value" }, type: "text-input" },
                { id: "id", text: {}, attributes: { key: "value" }, type: "text" },
                {
                    id: "id",
                    componentId: "componentId",
                    propertyOverrides: [{ propertyId: "7dd14c08-2e96-8d3d-2b19-b5c03642a0f0" }],
                    type: "component-instance",
                },
            ],
            pagination: { limit: 4, offset: 0, total: 4 },
            lastUpdated: "2016-10-24T19:42:38Z",
        };
        server
            .mockEndpoint()
            .get("/pages/63c720f9347c2139b248e552/dom")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.pages.getContent("63c720f9347c2139b248e552", {
            localeId: "65427cf400e02b306eaa04a0",
        });
        expect(response).toEqual({
            pageId: "658205daa3e8206a523b5ad4",
            branchId: "68026fa68ef6dc744c75b833",
            nodes: [
                {
                    type: "text",
                    id: "id",
                    text: {},
                    attributes: {
                        key: "value",
                    },
                },
                {
                    type: "text",
                    id: "id",
                    text: {},
                    attributes: {
                        key: "value",
                    },
                },
                {
                    type: "image",
                    id: "id",
                    image: {},
                    attributes: {
                        key: "value",
                    },
                },
                {
                    type: "select",
                    id: "id",
                    choices: [
                        {
                            value: "value",
                            text: "text",
                        },
                    ],
                    attributes: {
                        key: "value",
                    },
                },
                {
                    type: "text-input",
                    id: "id",
                    placeholder: "placeholder",
                    attributes: {
                        key: "value",
                    },
                },
                {
                    type: "text",
                    id: "id",
                    text: {},
                    attributes: {
                        key: "value",
                    },
                },
                {
                    type: "component-instance",
                    id: "id",
                    componentId: "componentId",
                    propertyOverrides: [
                        {
                            propertyId: "7dd14c08-2e96-8d3d-2b19-b5c03642a0f0",
                        },
                    ],
                },
            ],
            pagination: {
                limit: 4,
                offset: 0,
                total: 4,
            },
            lastUpdated: new Date("2016-10-24T19:42:38.000Z"),
        });
    });

    test("update-static-content", async () => {
        const server = mockServerPool.createServer();
        const client = new WebflowClient({
            accessToken: "test",
            environment: {
                base: server.baseUrl,
                dataApi: server.baseUrl,
                contentDeliveryApi: server.baseUrl,
                production: server.baseUrl,
                cdn: server.baseUrl,
            },
        });
        const rawRequestBody = {
            nodes: [
                {
                    nodeId: "a245c12d-995b-55ee-5ec7-aa36a6cad623",
                    text: "<h1>The Hitchhiker's Guide to the Galaxy</h1>",
                },
                {
                    nodeId: "a245c12d-995b-55ee-5ec7-aa36a6cad627",
                    text: "<div><h3>Don't Panic!</h3><p>Always know where your towel is.</p></div>",
                },
                {
                    nodeId: "a245c12d-995b-55ee-5ec7-aa36a6cad635",
                    choices: [
                        { value: "choice-1", text: "First choice" },
                        { value: "choice-2", text: "Second choice" },
                    ],
                },
                { nodeId: "a245c12d-995b-55ee-5ec7-aa36a6cad642", placeholder: "Enter something here..." },
                { nodeId: "a245c12d-995b-55ee-5ec7-aa36a6cad671", value: "Submit", waitingText: "Submitting..." },
                {
                    nodeId: "a245c12d-995b-55ee-5ec7-aa36a6cad629",
                    propertyOverrides: [
                        {
                            propertyId: "7dd14c08-2e96-8d3d-2b19-b5c03642a0f0",
                            text: "<div><h1>Time is an <em>illusion</em></h1></div>",
                        },
                        {
                            propertyId: "7dd14c08-2e96-8d3d-2b19-b5c03642a0f1",
                            text: "Life, the Universe and Everything",
                        },
                    ],
                },
            ],
        };
        const rawResponseBody = { errors: ["errors"] };
        server
            .mockEndpoint()
            .post("/pages/63c720f9347c2139b248e552/dom")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.pages.updateStaticContent("63c720f9347c2139b248e552", {
            localeId: "localeId",
            nodes: [
                {
                    nodeId: "a245c12d-995b-55ee-5ec7-aa36a6cad623",
                    text: "<h1>The Hitchhiker's Guide to the Galaxy</h1>",
                },
                {
                    nodeId: "a245c12d-995b-55ee-5ec7-aa36a6cad627",
                    text: "<div><h3>Don't Panic!</h3><p>Always know where your towel is.</p></div>",
                },
                {
                    nodeId: "a245c12d-995b-55ee-5ec7-aa36a6cad635",
                    choices: [
                        {
                            value: "choice-1",
                            text: "First choice",
                        },
                        {
                            value: "choice-2",
                            text: "Second choice",
                        },
                    ],
                },
                {
                    nodeId: "a245c12d-995b-55ee-5ec7-aa36a6cad642",
                    placeholder: "Enter something here...",
                },
                {
                    nodeId: "a245c12d-995b-55ee-5ec7-aa36a6cad671",
                    value: "Submit",
                    waitingText: "Submitting...",
                },
                {
                    nodeId: "a245c12d-995b-55ee-5ec7-aa36a6cad629",
                    propertyOverrides: [
                        {
                            propertyId: "7dd14c08-2e96-8d3d-2b19-b5c03642a0f0",
                            text: "<div><h1>Time is an <em>illusion</em></h1></div>",
                        },
                        {
                            propertyId: "7dd14c08-2e96-8d3d-2b19-b5c03642a0f1",
                            text: "Life, the Universe and Everything",
                        },
                    ],
                },
            ],
        });
        expect(response).toEqual({
            errors: ["errors"],
        });
    });
});
