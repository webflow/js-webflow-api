/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../../mock-server/MockServerPool.js";
import { WebflowClient } from "../../../src/Client";

describe("Forms", () => {
    test("list-submissions-by-site", async () => {
        const server = mockServerPool.createServer();
        const client = new WebflowClient({
            accessToken: "test",
            environment: { base: server.baseUrl, dataApi: server.baseUrl, contentDeliveryApi: server.baseUrl },
        });

        const rawResponseBody = {
            formSubmissions: [
                {
                    id: "6321ca84df3949bfc6752327",
                    displayName: "Sample Form",
                    siteId: "62749158efef318abc8d5a0f",
                    workspaceId: "62749158efef318abc8d5a0f",
                    dateSubmitted: "2022-09-14T12:35:16Z",
                    formResponse: { "First Name": "Arthur", "Last Name": "Dent" },
                },
                {
                    id: "660d64fabf6e0a0d4edab981",
                    displayName: "Sample Form",
                    siteId: "62749158efef318abc8d5a0f",
                    workspaceId: "62749158efef318abc8d5a0f",
                    dateSubmitted: "2022-09-14T12:35:16Z",
                    formResponse: { "First Name": "Ford", "Last Name": "Prefect" },
                },
            ],
            pagination: { limit: 25, offset: 0, total: 2 },
        };
        server
            .mockEndpoint()
            .get("/sites/580e63e98c9a982ac9b8b741/form_submissions")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.sites.forms.listSubmissionsBySite("580e63e98c9a982ac9b8b741", {
            elementId: "18259716-3e5a-646a-5f41-5dc4b9405aa0",
            offset: 1.1,
            limit: 1.1,
        });
        expect(response).toEqual({
            formSubmissions: [
                {
                    id: "6321ca84df3949bfc6752327",
                    displayName: "Sample Form",
                    siteId: "62749158efef318abc8d5a0f",
                    workspaceId: "62749158efef318abc8d5a0f",
                    dateSubmitted: new Date("2022-09-14T12:35:16.000Z"),
                    formResponse: {
                        "First Name": "Arthur",
                        "Last Name": "Dent",
                    },
                },
                {
                    id: "660d64fabf6e0a0d4edab981",
                    displayName: "Sample Form",
                    siteId: "62749158efef318abc8d5a0f",
                    workspaceId: "62749158efef318abc8d5a0f",
                    dateSubmitted: new Date("2022-09-14T12:35:16.000Z"),
                    formResponse: {
                        "First Name": "Ford",
                        "Last Name": "Prefect",
                    },
                },
            ],
            pagination: {
                limit: 25,
                offset: 0,
                total: 2,
            },
        });
    });

    test("list-submissions-by-form-and-site", async () => {
        const server = mockServerPool.createServer();
        const client = new WebflowClient({
            accessToken: "test",
            environment: { base: server.baseUrl, dataApi: server.baseUrl, contentDeliveryApi: server.baseUrl },
        });

        const rawResponseBody = {
            formSubmissions: [
                {
                    id: "6321ca84df3949bfc6752327",
                    displayName: "Sample Form",
                    siteId: "62749158efef318abc8d5a0f",
                    workspaceId: "62749158efef318abc8d5a0f",
                    dateSubmitted: "2022-09-14T12:35:16Z",
                    formResponse: { "First Name": "Arthur", "Last Name": "Dent" },
                },
                {
                    id: "660d64fabf6e0a0d4edab981",
                    displayName: "Sample Form",
                    siteId: "62749158efef318abc8d5a0f",
                    workspaceId: "62749158efef318abc8d5a0f",
                    dateSubmitted: "2022-09-14T12:35:16Z",
                    formResponse: { "First Name": "Ford", "Last Name": "Prefect" },
                },
            ],
            pagination: { limit: 25, offset: 0, total: 2 },
        };
        server
            .mockEndpoint()
            .get("/sites/580e63e98c9a982ac9b8b741/forms/580e63e98c9a982ac9b8b741/submissions")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.sites.forms.listSubmissionsByFormAndSite(
            "580e63e98c9a982ac9b8b741",
            "580e63e98c9a982ac9b8b741",
            {
                offset: 1.1,
                limit: 1.1,
            },
        );
        expect(response).toEqual({
            formSubmissions: [
                {
                    id: "6321ca84df3949bfc6752327",
                    displayName: "Sample Form",
                    siteId: "62749158efef318abc8d5a0f",
                    workspaceId: "62749158efef318abc8d5a0f",
                    dateSubmitted: new Date("2022-09-14T12:35:16.000Z"),
                    formResponse: {
                        "First Name": "Arthur",
                        "Last Name": "Dent",
                    },
                },
                {
                    id: "660d64fabf6e0a0d4edab981",
                    displayName: "Sample Form",
                    siteId: "62749158efef318abc8d5a0f",
                    workspaceId: "62749158efef318abc8d5a0f",
                    dateSubmitted: new Date("2022-09-14T12:35:16.000Z"),
                    formResponse: {
                        "First Name": "Ford",
                        "Last Name": "Prefect",
                    },
                },
            ],
            pagination: {
                limit: 25,
                offset: 0,
                total: 2,
            },
        });
    });

    test("get-submission", async () => {
        const server = mockServerPool.createServer();
        const client = new WebflowClient({
            accessToken: "test",
            environment: { base: server.baseUrl, dataApi: server.baseUrl, contentDeliveryApi: server.baseUrl },
        });

        const rawResponseBody = {
            id: "6321ca84df3949bfc6752327",
            displayName: "Sample Form",
            siteId: "62749158efef318abc8d5a0f",
            workspaceId: "62749158efef318abc8d5a0f",
            dateSubmitted: "2022-09-14T12:35:16Z",
            formResponse: { "First Name": "Arthur", "Last Name": "Dent" },
        };
        server
            .mockEndpoint()
            .get("/sites/580e63e98c9a982ac9b8b741/form_submissions/580e63e98c9a982ac9b8b741")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.sites.forms.getSubmission("580e63e98c9a982ac9b8b741", "580e63e98c9a982ac9b8b741");
        expect(response).toEqual({
            id: "6321ca84df3949bfc6752327",
            displayName: "Sample Form",
            siteId: "62749158efef318abc8d5a0f",
            workspaceId: "62749158efef318abc8d5a0f",
            dateSubmitted: new Date("2022-09-14T12:35:16.000Z"),
            formResponse: {
                "First Name": "Arthur",
                "Last Name": "Dent",
            },
        });
    });

    test("delete-submission", async () => {
        const server = mockServerPool.createServer();
        const client = new WebflowClient({
            accessToken: "test",
            environment: { base: server.baseUrl, dataApi: server.baseUrl, contentDeliveryApi: server.baseUrl },
        });

        server
            .mockEndpoint()
            .delete("/sites/580e63e98c9a982ac9b8b741/form_submissions/580e63e98c9a982ac9b8b741")
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.sites.forms.deleteSubmission(
            "580e63e98c9a982ac9b8b741",
            "580e63e98c9a982ac9b8b741",
        );
        expect(response).toEqual(undefined);
    });

    test("update-submission", async () => {
        const server = mockServerPool.createServer();
        const client = new WebflowClient({
            accessToken: "test",
            environment: { base: server.baseUrl, dataApi: server.baseUrl, contentDeliveryApi: server.baseUrl },
        });
        const rawRequestBody = {};
        const rawResponseBody = {
            id: "6321ca84df3949bfc6752327",
            displayName: "Sample Form",
            siteId: "62749158efef318abc8d5a0f",
            workspaceId: "62749158efef318abc8d5a0f",
            dateSubmitted: "2022-09-14T12:35:16Z",
            formResponse: { "First Name": "Arthur", "Last Name": "Dent" },
        };
        server
            .mockEndpoint()
            .patch("/sites/580e63e98c9a982ac9b8b741/form_submissions/580e63e98c9a982ac9b8b741")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.sites.forms.updateSubmission(
            "580e63e98c9a982ac9b8b741",
            "580e63e98c9a982ac9b8b741",
        );
        expect(response).toEqual({
            id: "6321ca84df3949bfc6752327",
            displayName: "Sample Form",
            siteId: "62749158efef318abc8d5a0f",
            workspaceId: "62749158efef318abc8d5a0f",
            dateSubmitted: new Date("2022-09-14T12:35:16.000Z"),
            formResponse: {
                "First Name": "Arthur",
                "Last Name": "Dent",
            },
        });
    });
});
