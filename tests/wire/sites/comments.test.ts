/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../../mock-server/MockServerPool.js";
import { WebflowClient } from "../../../src/Client";

describe("Comments", () => {
    test("list-comment-threads", async () => {
        const server = mockServerPool.createServer();
        const client = new WebflowClient({
            accessToken: "test",
            environment: {
                base: server.baseUrl,
                dataApi: server.baseUrl,
                contentDeliveryApi: server.baseUrl,
                production: server.baseUrl,
                cdn: server.baseUrl,
            },
        });

        const rawResponseBody = {
            comments: [
                {
                    id: "679d2ddb5196117ad04d1ffa",
                    siteId: "679826b3b20b045e176bc4b5",
                    pageId: "679826b3b20b045e176bc4bc",
                    localeId: "67993753d910db250db64b3e",
                    breakpoint: "main",
                    url: "https://webflow.com/design/site-slug-4ec832?workflow=comment&commentId=679d2ddb5196117ad04d1ff8&pageId=679826b3b20b045e176bc4bc",
                    content: "Let's go to the pub! [[6287ec36a841b25637c663df]] ",
                    isResolved: false,
                    author: {
                        userId: "6287ec36a841b25637c663df",
                        email: "ford.prefect@heartofgold.spaceship",
                        name: "Ford Prefect",
                    },
                    mentionedUsers: [
                        {
                            userId: "6287ec36a841b25637c663df",
                            email: "arthur.dent@heartofgold.spaceship",
                            name: "Arthur Dent",
                        },
                    ],
                    createdOn: "2025-01-31T20:08:59.759Z",
                    lastUpdated: "2025-01-31T20:08:59.759Z",
                },
                {
                    id: "679d2ddb5196117ad04d1ffc",
                    siteId: "679826b3b20b045e176bc4b5",
                    pageId: "679826b3b20b045e176bc4bc",
                    localeId: "67993753d910db250db64b3e",
                    breakpoint: "main",
                    url: "https://webflow.com/design/site-slug-4ec832?workflow=comment&commentId=679d2ddb5196117ad04d1ff8&pageId=679826b3b20b045e176bc4bc",
                    content: "You have five minutes left to drink it [[6287ec36a841b25637c663df]] ",
                    isResolved: false,
                    author: {
                        userId: "6287ec36a841b25637c663df",
                        email: "ford.prefect@heartofgold.spaceship",
                        name: "Ford Prefect",
                    },
                    mentionedUsers: [
                        {
                            userId: "6287ec36a841b25637c663df",
                            email: "arthur.dent@heartofgold.spaceship",
                            name: "Arthur Dent",
                        },
                    ],
                    createdOn: "2025-01-31T20:08:59.759Z",
                    lastUpdated: "2025-01-31T20:08:59.759Z",
                },
            ],
            pagination: { limit: 2, offset: 0, total: 2 },
        };
        server
            .mockEndpoint()
            .get("/sites/580e63e98c9a982ac9b8b741/comments")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.sites.comments.listCommentThreads("580e63e98c9a982ac9b8b741", {
            localeId: "65427cf400e02b306eaa04a0",
        });
        expect(response).toEqual({
            comments: [
                {
                    id: "679d2ddb5196117ad04d1ffa",
                    siteId: "679826b3b20b045e176bc4b5",
                    pageId: "679826b3b20b045e176bc4bc",
                    localeId: "67993753d910db250db64b3e",
                    breakpoint: "main",
                    url: "https://webflow.com/design/site-slug-4ec832?workflow=comment&commentId=679d2ddb5196117ad04d1ff8&pageId=679826b3b20b045e176bc4bc",
                    content: "Let's go to the pub! [[6287ec36a841b25637c663df]] ",
                    isResolved: false,
                    author: {
                        userId: "6287ec36a841b25637c663df",
                        email: "ford.prefect@heartofgold.spaceship",
                        name: "Ford Prefect",
                    },
                    mentionedUsers: [
                        {
                            userId: "6287ec36a841b25637c663df",
                            email: "arthur.dent@heartofgold.spaceship",
                            name: "Arthur Dent",
                        },
                    ],
                    createdOn: "2025-01-31T20:08:59.759Z",
                    lastUpdated: "2025-01-31T20:08:59.759Z",
                },
                {
                    id: "679d2ddb5196117ad04d1ffc",
                    siteId: "679826b3b20b045e176bc4b5",
                    pageId: "679826b3b20b045e176bc4bc",
                    localeId: "67993753d910db250db64b3e",
                    breakpoint: "main",
                    url: "https://webflow.com/design/site-slug-4ec832?workflow=comment&commentId=679d2ddb5196117ad04d1ff8&pageId=679826b3b20b045e176bc4bc",
                    content: "You have five minutes left to drink it [[6287ec36a841b25637c663df]] ",
                    isResolved: false,
                    author: {
                        userId: "6287ec36a841b25637c663df",
                        email: "ford.prefect@heartofgold.spaceship",
                        name: "Ford Prefect",
                    },
                    mentionedUsers: [
                        {
                            userId: "6287ec36a841b25637c663df",
                            email: "arthur.dent@heartofgold.spaceship",
                            name: "Arthur Dent",
                        },
                    ],
                    createdOn: "2025-01-31T20:08:59.759Z",
                    lastUpdated: "2025-01-31T20:08:59.759Z",
                },
            ],
            pagination: {
                limit: 2,
                offset: 0,
                total: 2,
            },
        });
    });

    test("get-comment-thread", async () => {
        const server = mockServerPool.createServer();
        const client = new WebflowClient({
            accessToken: "test",
            environment: {
                base: server.baseUrl,
                dataApi: server.baseUrl,
                contentDeliveryApi: server.baseUrl,
                production: server.baseUrl,
                cdn: server.baseUrl,
            },
        });

        const rawResponseBody = {
            id: "580e64008c9a982ac9b8b754",
            siteId: "580e64008c9a982ac9b8b754",
            pageId: "580e64008c9a982ac9b8b754",
            localeId: "580e64008c9a982ac9b8b754",
            itemId: "580e64008c9a982ac9b8b754",
            breakpoint: "main",
            url: "https://webflow.com/design/site-slug-4ec832?workflow=comment&commentId=679d2ddb5196117ad04d1ff8&pageId=679826b3b20b045e176bc4bc",
            content: "This is a comment reply",
            isResolved: true,
            author: { userId: "userId", email: "email", name: "name" },
            mentionedUsers: [
                { userId: "6287ec36a841b25637c663df", email: "arthur.dent@heartofgold.spaceship", name: "Arthur Dent" },
            ],
            createdOn: "2023-03-17T18:47:35.560Z",
            lastUpdated: "2023-03-17T18:47:35.560Z",
        };
        server
            .mockEndpoint()
            .get("/sites/580e63e98c9a982ac9b8b741/comments/580e63e98c9a982ac9b8b741")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.sites.comments.getCommentThread(
            "580e63e98c9a982ac9b8b741",
            "580e63e98c9a982ac9b8b741",
            {
                localeId: "65427cf400e02b306eaa04a0",
            },
        );
        expect(response).toEqual({
            id: "580e64008c9a982ac9b8b754",
            siteId: "580e64008c9a982ac9b8b754",
            pageId: "580e64008c9a982ac9b8b754",
            localeId: "580e64008c9a982ac9b8b754",
            itemId: "580e64008c9a982ac9b8b754",
            breakpoint: "main",
            url: "https://webflow.com/design/site-slug-4ec832?workflow=comment&commentId=679d2ddb5196117ad04d1ff8&pageId=679826b3b20b045e176bc4bc",
            content: "This is a comment reply",
            isResolved: true,
            author: {
                userId: "userId",
                email: "email",
                name: "name",
            },
            mentionedUsers: [
                {
                    userId: "6287ec36a841b25637c663df",
                    email: "arthur.dent@heartofgold.spaceship",
                    name: "Arthur Dent",
                },
            ],
            createdOn: "2023-03-17T18:47:35.560Z",
            lastUpdated: "2023-03-17T18:47:35.560Z",
        });
    });

    test("list-comment-replies", async () => {
        const server = mockServerPool.createServer();
        const client = new WebflowClient({
            accessToken: "test",
            environment: {
                base: server.baseUrl,
                dataApi: server.baseUrl,
                contentDeliveryApi: server.baseUrl,
                production: server.baseUrl,
                cdn: server.baseUrl,
            },
        });

        const rawResponseBody = {
            comments: [
                {
                    id: "679d2ddb5196117ad04d1ffa",
                    commentId: "679d2ddb5196117ad04d1ff8",
                    siteId: "679826b3b20b045e176bc4b5",
                    pageId: "679826b3b20b045e176bc4bc",
                    localeId: "67993753d910db250db64b3e",
                    breakpoint: "main",
                    content: "This comment mentions another user [[6287ec36a841b25637c663df]] ",
                    isResolved: false,
                    author: { id: "id", email: "email", name: "name" },
                    mentionedUsers: [{ id: "id", email: "arthur.dent@example.com", name: "Arthur Dent" }],
                    lastUpdated: "2025-01-31T20:08:59.759Z",
                    createdOn: "2025-01-31T20:08:59.759Z",
                },
            ],
            pagination: { limit: 2, offset: 0, total: 1 },
        };
        server
            .mockEndpoint()
            .get("/sites/580e63e98c9a982ac9b8b741/comments/580e63e98c9a982ac9b8b741/replies")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.sites.comments.listCommentReplies(
            "580e63e98c9a982ac9b8b741",
            "580e63e98c9a982ac9b8b741",
            {
                localeId: "65427cf400e02b306eaa04a0",
            },
        );
        expect(response).toEqual({
            comments: [
                {
                    id: "679d2ddb5196117ad04d1ffa",
                    commentId: "679d2ddb5196117ad04d1ff8",
                    siteId: "679826b3b20b045e176bc4b5",
                    pageId: "679826b3b20b045e176bc4bc",
                    localeId: "67993753d910db250db64b3e",
                    breakpoint: "main",
                    content: "This comment mentions another user [[6287ec36a841b25637c663df]] ",
                    isResolved: false,
                    author: {
                        id: "id",
                        email: "email",
                        name: "name",
                    },
                    mentionedUsers: [
                        {
                            id: "id",
                            email: "arthur.dent@example.com",
                            name: "Arthur Dent",
                        },
                    ],
                    lastUpdated: "2025-01-31T20:08:59.759Z",
                    createdOn: "2025-01-31T20:08:59.759Z",
                },
            ],
            pagination: {
                limit: 2,
                offset: 0,
                total: 1,
            },
        });
    });
});
